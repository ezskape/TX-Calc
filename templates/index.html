<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>True Texas Electricity Rate Calculator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
  </head>
  <body>
    <main class="container">
      <header class="page-header">
        <h1>True Texas Electricity Rate Calculator</h1>
        <p class="subtitle">
          Know your true electricity costs. Calculate your true rate per kWh as well as an
          approximate bill amount
        </p>
      </header>

      <div class="tab-bar" role="tablist" aria-label="Plan options">
        <button
          class="tab-button is-active"
          id="tab-fixed-rate"
          type="button"
          role="tab"
          aria-selected="true"
          aria-controls="panel-fixed-rate"
          data-target="panel-fixed-rate"
        >
          Fixed Rate
        </button>
        <button
          class="tab-button"
          id="tab-fixed-rate-credit"
          type="button"
          role="tab"
          aria-selected="false"
          aria-controls="panel-fixed-rate-credit"
          data-target="panel-fixed-rate-credit"
        >
          Fixed Rate with Credit
        </button>
        <button
          class="tab-button"
          id="tab-tiered-plan"
          type="button"
          role="tab"
          aria-selected="false"
          aria-controls="panel-tiered-plan"
          data-target="panel-tiered-plan"
        >
          Tiered Plans
        </button>
        <button
          class="tab-button"
          id="tab-tou-plan"
          type="button"
          role="tab"
          aria-selected="false"
          aria-controls="tou-plan"
          data-target="tou-plan"
        >
          Time-of-Use (Free Nights/Weekends)
        </button>
      </div>

      <section class="card tdu-card" aria-label="Transmission and Distribution Utility selector">
        <label class="form-field" for="tduSelect">
          <span>Select Your TDU</span>
          <select id="tduSelect" class="tdu-select" required></select>
        </label>
        <p class="helper-text tdu-helper-text is-hidden">
          TDU delivery charges do NOT apply during the free usage period.
        </p>
        <div class="form-grid tdu-delivery-grid">
          <label class="form-field">
            <span>Delivery Rate (¢ per kWh)</span>
            <input
              type="number"
              id="tdu-delivery-rate"
              min="0"
              step="0.01"
              required
            />
          </label>
          <label class="form-field">
            <span>Delivery Charge ($ per billing cycle)</span>
            <input
              type="number"
              id="tdu-base-delivery-charge"
              min="0"
              step="0.01"
              required
            />
          </label>
        </div>
      </section>

      <section
        class="tab-panel is-active"
        id="panel-fixed-rate"
        role="tabpanel"
        aria-labelledby="tab-fixed-rate"
      >
        <form class="plan-form" data-plan-type="fixed_rate" novalidate>
          <section class="card">
            <div class="card-header">
              <h2>Fixed Rate</h2>
            </div>
            <input
              type="hidden"
              id="fixed-delivery-rate"
              name="tdu_rate_cents"
              required
            />
            <input
              type="hidden"
              id="fixed-base-delivery-charge"
              name="base_delivery_charge"
              required
            />
            <div class="form-grid">
              <label class="form-field">
                <span>Energy Rate (¢/kWh)</span>
                <input
                  type="number"
                  id="fixed-energy-rate"
                  name="energy_rate_cents"
                  min="0"
                  step="0.01"
                  required
                />
              </label>
              <label class="form-field">
                <span>Base Charge ($ per billing cycle)</span>
                <input
                  type="number"
                  id="fixed-base-charge"
                  name="base_charge"
                  min="0"
                  step="0.01"
                  required
                />
              </label>
            </div>
          </section>

          <section class="card">
            <h2>Calculate your price per kWh and approximate bill amount</h2>
            <div class="form-field usage-field">
              <span>Enter your kWh usage</span>
              <input
                type="number"
                id="fixed-usage"
                name="usage_kwh"
                min="1"
                step="1"
                required
              />
            </div>
            <div class="form-actions">
              <button type="submit" class="calculate-button">Calculate</button>
              <button type="button" class="clear-button">Clear</button>
            </div>
          </section>

          <section class="card results-card">
            <p class="results-placeholder">
              Enter all plan details and your kWh usage to see your true rate and estimated bill.
            </p>
            <div class="results-grid is-hidden">
              <div>
                <h3>True Rate Per kWh</h3>
                <p class="result-value"><span class="result-true-rate">0.00</span> ¢/kWh</p>
              </div>
              <div>
                <h3>Approximate Bill Amount</h3>
                <p class="result-value">$<span class="result-bill-amount">0.00</span></p>
              </div>
            </div>
            <p class="result-note is-hidden">
              True rate per kWh is calculated using information entered, approximate bill
              amount is calculated as price per kwh * kwh usage.
            </p>
          </section>

          <section class="card error-card" hidden>
            <h2>There was a problem with your calculation</h2>
            <p class="error-message"></p>
          </section>
        </form>
      </section>

      <section
        class="tab-panel"
        id="panel-fixed-rate-credit"
        role="tabpanel"
        aria-labelledby="tab-fixed-rate-credit"
        hidden
      >
        <form class="plan-form" data-plan-type="fixed_rate_credit" novalidate>
          <section class="card">
            <div class="card-header">
              <h2>Fixed Rate with Credit</h2>
            </div>
            <input
              type="hidden"
              id="credit-delivery-rate"
              name="tdu_rate_cents"
              required
            />
            <input
              type="hidden"
              id="credit-base-delivery-charge"
              name="base_delivery_charge"
              required
            />
            <div class="form-grid">
              <label class="form-field">
                <span>Energy Rate (¢/kWh)</span>
                <input
                  type="number"
                  id="credit-energy-rate"
                  name="energy_rate_cents"
                  min="0"
                  step="0.01"
                  required
                />
              </label>
              <label class="form-field">
                <span>Base Charge ($ per billing cycle)</span>
                <input
                  type="number"
                  id="credit-base-charge"
                  name="base_charge"
                  min="0"
                  step="0.01"
                  required
                />
              </label>
            </div>
            <div class="form-grid">
              <label class="form-field">
                <span>Usage Credit ($)</span>
                <input
                  type="number"
                  id="usage-credit"
                  name="usage_credit"
                  min="0"
                  step="0.01"
                  value="0"
                  required
                />
              </label>
              <label class="form-field">
                <span>Usage equal or more than (kWh)</span>
                <input
                  type="number"
                  id="credit-threshold"
                  name="credit_threshold_kwh"
                  min="0"
                  step="1"
                  value="1000"
                  required
                />
              </label>
            </div>
          </section>

          <section class="card">
            <h2>Calculate your price per kWh and approximate bill amount</h2>
            <div class="form-field usage-field">
              <span>Enter your kWh usage</span>
              <input
                type="number"
                id="credit-usage"
                name="usage_kwh"
                min="1"
                step="1"
                required
              />
            </div>

            <div class="form-actions">
              <button type="submit" class="calculate-button">Calculate</button>
              <button type="button" class="clear-button">Clear</button>
            </div>
          </section>

          <section class="card results-card">
            <p class="results-placeholder">
              Enter all plan details and your kWh usage to see your true rate and estimated bill.
            </p>
            <div class="results-grid is-hidden">
              <div>
                <h3>True Rate Per kWh</h3>
                <p class="result-value"><span class="result-true-rate">0.00</span> ¢/kWh</p>
              </div>
              <div>
                <h3>Approximate Bill Amount</h3>
                <p class="result-value">$<span class="result-bill-amount">0.00</span></p>
              </div>
            </div>
            <p class="result-note is-hidden">
              True rate per kWh subtracts the usage credit from the total charge when your usage
              meets the entered kWh threshold.
            </p>
          </section>

          <section class="card error-card" hidden>
            <h2>There was a problem with your calculation</h2>
            <p class="error-message"></p>
          </section>
        </form>
      </section>

      <section
        class="tab-panel"
        id="panel-tiered-plan"
        role="tabpanel"
        aria-labelledby="tab-tiered-plan"
        hidden
      >
        <form class="plan-form" data-plan-type="tiered_plan" novalidate>
          <section class="card tiered-plan-card">
            <h3>Tiered Plans</h3>

            <input type="hidden" id="tiered-delivery-rate" name="tdu_rate_cents" />
            <input type="hidden" id="tiered-base-delivery-charge" name="base_delivery_charge" />

            <p class="helper-text">
              Enter the plan's own rates and fees from the EFL. TDU delivery charges come from the
              selector above and are automatically included in the calculation.
            </p>

            <div class="form-row">
              <label for="tierBaseCharge">Base Charge ($ per billing cycle)</label>
              <input id="tierBaseCharge" type="number" step="0.01" placeholder="e.g. 9.95 or 0" />
              <small>
                This is the plan's fixed monthly charge from the EFL (not the TDU delivery charge).
              </small>
            </div>

            <div class="form-row">
              <label for="tier1Rate">Tier 1 Energy Rate (¢/kWh)</label>
              <input id="tier1Rate" type="number" step="0.0001" placeholder="e.g. 13.1" />
            </div>

            <div class="form-row">
              <label for="tier1Limit">Tier 1 Usage Limit (kWh)</label>
              <input id="tier1Limit" type="number" step="1" placeholder="e.g. 1000" />
              <small>
                Enter the upper end of Tier 1 from your EFL (for "0–1000 kWh", type 1000).
              </small>
            </div>

            <div class="form-row">
              <label for="tier2Rate">Tier 2 Energy Rate (¢/kWh) — optional</label>
              <input
                id="tier2Rate"
                type="number"
                step="0.0001"
                placeholder="e.g. 14.3, or leave blank if no Tier 2"
              />
            </div>

            <div class="form-row">
              <label for="tier2Limit">Tier 2 Usage Limit (kWh) — optional</label>
              <input
                id="tier2Limit"
                type="number"
                step="1"
                placeholder="e.g. 2000, or leave blank if your EFL only has 2 ranges"
              />
              <small>
                If your EFL has only two ranges (e.g. "0–1200" and ">1200"), leave this blank and
                use Tier 3 rate for "above Tier 1".
              </small>
            </div>

            <div class="form-row">
              <label for="tier3Rate">Tier 3 Energy Rate (¢/kWh) for usage above the last limit — optional</label>
              <input id="tier3Rate" type="number" step="0.0001" placeholder="e.g. 16.9, or leave blank if no Tier 3" />
              <small>
                Used for any kWh above Tier 2’s limit. Leave blank if your plan has only one or two
                energy tiers.
              </small>
            </div>
          </section>

          <section class="card tiered-flat-fees-card">
            <h3>Flat Tier Fee Rules (Optional)</h3>
            <p class="helper">
              Use this section for flat monthly fees that change at a usage threshold. Example from
              an EFL: “Usage Charge $9.95 per billing cycle &lt; 1,000 kWh, $0.00 ≥ 1,000 kWh”.
            </p>

            <div class="form-row">
              <label for="tierFlatFee1">Tier 1 Flat Fee ($)</label>
              <input id="tierFlatFee1" type="number" step="0.01" placeholder="e.g. 9.95" />
            </div>

            <div class="form-row">
              <label for="tierFlatThreshold">Tier 1 applies when total usage is BELOW (kWh)</label>
              <input id="tierFlatThreshold" type="number" step="1" placeholder="e.g. 1000" />
              <small>
                If your EFL says “Usage charge applies when usage is &lt; 1,000 kWh”, enter 1000
                here.
              </small>
            </div>

            <div class="form-row">
              <label for="tierFlatFee2">Tier 2 Flat Fee ($) — for usage AT OR ABOVE the threshold (optional)</label>
              <input id="tierFlatFee2" type="number" step="0.01" placeholder="e.g. 0.00" />
              <small>
                Enter the alternate flat fee when usage meets or exceeds the threshold. Leave 0 if
                there is no second flat fee.
              </small>
            </div>
          </section>

          <section class="card">
            <h2>Calculate your price per kWh and approximate bill amount</h2>
            <div class="form-field usage-field">
              <span>Enter your kWh usage</span>
              <input
                type="number"
                id="tiered-usage"
                name="usage_kwh"
                min="1"
                step="1"
                required
              />
            </div>

            <div class="form-actions">
              <button type="submit" class="calculate-button">Calculate</button>
              <button type="button" class="clear-button">Clear</button>
            </div>
          </section>

          <section class="card results-card">
            <p class="results-placeholder">
              Enter all plan details and your kWh usage to see your true rate and estimated bill.
            </p>
            <div class="results-grid is-hidden">
              <div>
                <h3>True Rate Per kWh</h3>
                <p class="result-value"><span class="result-true-rate">0.00</span> ¢/kWh</p>
              </div>
              <div>
                <h3>Approximate Bill Amount</h3>
                <p class="result-value">$<span class="result-bill-amount">0.00</span></p>
              </div>
            </div>
            <p class="result-note is-hidden">
              True rate per kWh is calculated using the tiered rate and flat tier details you enter.
              TDU delivery charges from the selector above are included automatically.
            </p>
          </section>

          <section class="card error-card" hidden>
            <h2>There was a problem with your calculation</h2>
            <p class="error-message"></p>
          </section>
        </form>
      </section>

      <section class="tab-panel" id="tou-plan" role="tabpanel" aria-labelledby="tab-tou-plan" hidden>
        <section class="card">
          <div class="card-header">
            <h2>Time-of-Use (Free Nights/Weekends)</h2>
          </div>
          <input type="hidden" id="touDeliveryRate" min="0" step="0.01" />
          <input type="hidden" id="touBaseDeliveryCharge" min="0" step="0.01" />
          <div class="form-grid">
            <label class="form-field">
              <span>Energy Rate (¢/kWh)</span>
              <input
                type="number"
                id="touOnPeakRate"
                min="0"
                step="0.01"
                placeholder="Rate paid during NON-free hours"
              />
            </label>
            <label class="form-field">
              <span>Free Hours Rate (¢/kWh)</span>
              <input
                type="number"
                id="touOffPeakRate"
                min="0"
                step="0.01"
                placeholder="0¢ for most plans because nights/weekends are free"
                value="0"
              />
            </label>
            <label class="form-field">
              <span>Base Charge ($ per billing cycle)</span>
              <input type="number" id="touBaseCharge" min="0" step="0.01" />
            </label>
          </div>
        </section>

        <section class="card">
          <h2>Calculate your price per kWh and approximate bill amount</h2>
          <div class="form-grid usage-field">
            <label class="form-field">
              <span>Total Monthly Usage (kWh)</span>
              <input type="number" id="touTotalUsage" min="0" step="1" />
            </label>
            <label class="form-field">
              <span>Free Hours Usage (kWh)</span>
              <input
                type="number"
                id="touFreeUsage"
                min="0"
                step="1"
                placeholder="How many kWh you use during free nights/weekends"
              />
            </label>
          </div>
          <div class="form-actions">
            <button type="button" class="calculate-button" id="touCalculateBtn">Calculate</button>
            <button type="button" class="clear-button" id="touClearBtn">Clear</button>
          </div>
        </section>

        <section class="card results-card">
          <p class="results-placeholder">
            Enter all plan details and your kWh usage to see your true rate and estimated bill.
          </p>
          <div class="results-grid is-hidden">
            <div>
              <h3>True Rate Per kWh</h3>
              <p class="result-value"><span id="touEffectiveRate">0.00</span> ¢/kWh</p>
            </div>
            <div>
              <h3>Approximate Bill Amount</h3>
              <p class="result-value">$<span id="touApproxBill">0.00</span></p>
            </div>
          </div>
        </section>

        <section class="card error-card" hidden>
          <h2>There was a problem with your calculation</h2>
          <p class="error-message"></p>
        </section>
      </section>
    </main>

    <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
  </body>
</html>
